<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plataforma de Cursos</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://player.vimeo.com/api/player.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #5624d0;
      --primary-dark: #401b9c;
      --secondary: #2d2f31;
      --text-primary: #1c1d1f;
      --text-secondary: #6a6f73;
      --border: #d1d7dc;
      --bg-light: #f7f9fa;
      --white: #ffffff;
      --success: #5cb85c;
      --danger: #ec5252;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg-light);
      color: var(--text-primary);
      line-height: 1.6;
    }

    .navbar {
      background: var(--secondary);
      color: white;
      padding: 16px 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.08);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .navbar-container {
      max-width: 1340px;
      margin: 0 auto;
      padding: 0 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .navbar-brand {
      font-size: 24px;
      font-weight: 700;
      color: white;
    }

    .navbar-user {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .user-points {
      background: var(--primary);
      padding: 8px 16px;
      border-radius: 4px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .container {
      max-width: 1340px;
      margin: 0 auto;
      padding: 24px;
    }

    .tabs {
      display: flex;
      gap: 16px;
      margin-bottom: 32px;
      border-bottom: 2px solid var(--border);
    }

    .tab {
      background: none;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 600;
      color: var(--text-secondary);
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .tab:hover {
      color: var(--primary);
    }

    .tab.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .section-title {
      font-size: 28px;
      margin-bottom: 24px;
      color: var(--text-primary);
    }

    .video-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 24px;
    }

    .video-card {
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .video-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }

    .video-thumbnail {
      position: relative;
      width: 100%;
      height: 180px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 48px;
    }

    .video-thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .video-play-icon {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 48px;
      color: white;
      opacity: 0.9;
    }

    .video-info {
      padding: 16px;
    }

    .video-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text-primary);
    }

    .video-meta {
      display: flex;
      gap: 16px;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      overflow-y: auto;
    }

    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: white;
      border-radius: 8px;
      max-width: 900px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }

    .close-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      background: rgba(0,0,0,0.5);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 20px;
      cursor: pointer;
      z-index: 10;
    }

    .video-details {
      padding: 24px;
    }

    .video-stats {
      color: var(--text-secondary);
      margin: 12px 0;
      font-size: 14px;
    }

    .like-btn {
      margin-top: 16px;
      padding: 12px 24px;
      background: var(--white);
      border: 2px solid var(--border);
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
    }

    .like-btn:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    .like-btn.liked {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .quiz-section {
      display: none;
      padding: 24px;
      background: var(--bg-light);
      margin-top: 24px;
    }

    .quiz-timer {
      background: var(--danger);
      color: white;
      padding: 8px 16px;
      border-radius: 4px;
      text-align: center;
      font-weight: 600;
      margin-bottom: 16px;
    }

    .quiz-question {
      background: white;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
    }

    .quiz-question h4 {
      margin-bottom: 12px;
    }

    .quiz-option {
      display: block;
      padding: 12px;
      margin-bottom: 8px;
      background: var(--bg-light);
      border: 2px solid var(--border);
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .quiz-option:hover {
      border-color: var(--primary);
    }

    .quiz-option input[type="radio"] {
      margin-right: 8px;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
    }

    .trail-card {
      background: white;
      border-radius: 8px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .trail-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .trail-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .trail-progress {
      background: var(--bg-light);
      height: 8px;
      border-radius: 4px;
      margin: 12px 0;
      overflow: hidden;
    }

    .trail-progress-bar {
      height: 100%;
      background: var(--primary);
      transition: width 0.3s ease;
    }

    .trail-videos {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }

    .ranking-list {
      background: white;
      border-radius: 8px;
      overflow: hidden;
    }

    .ranking-item {
      display: flex;
      align-items: center;
      padding: 16px 24px;
      border-bottom: 1px solid var(--border);
    }

    .ranking-item:last-child {
      border-bottom: none;
    }

    .ranking-position {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-secondary);
      width: 60px;
    }

    .ranking-position.top-1 {
      color: #FFD700;
    }

    .ranking-position.top-2 {
      color: #C0C0C0;
    }

    .ranking-position.top-3 {
      color: #CD7F32;
    }

    .ranking-name {
      flex: 1;
      font-size: 16px;
      font-weight: 600;
    }

    .ranking-points {
      font-size: 18px;
      font-weight: 700;
      color: var(--primary);
    }

    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: white;
      padding: 16px 24px;
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      gap: 12px;
      z-index: 2000;
      animation: slideIn 0.3s ease;
    }

    .toast.success {
      border-left: 4px solid var(--success);
    }

    .toast.error {
      border-left: 4px solid var(--danger);
    }

    .toast.hiding {
      animation: slideOut 0.3s ease;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes slideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(400px);
        opacity: 0;
      }
    }

    .loading {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }

    .loading i {
      font-size: 48px;
      margin-bottom: 16px;
      color: var(--primary);
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }

    .empty-state i {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.3;
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="navbar-container">
      <div class="navbar-brand">
        <i class="fas fa-graduation-cap"></i>
        Plataforma de Cursos
      </div>
      <div class="navbar-user">
        <div class="user-points" id="userPoints">
          <i class="fas fa-star"></i>
          <span>0 pontos</span>
        </div>
        <span id="userName">Carregando...</span>
      </div>
    </div>
  </nav>

  <div class="container">
    <div class="tabs">
      <button class="tab active" data-tab="videos">
        <i class="fas fa-play-circle"></i>
        Vídeos
      </button>
      <button class="tab" data-tab="trails">
        <i class="fas fa-route"></i>
        Trilhas
      </button>
      <button class="tab" data-tab="ranking">
        <i class="fas fa-trophy"></i>
        Ranking
      </button>
      <button class="tab" data-tab="progress">
        <i class="fas fa-chart-line"></i>
        Meu Progresso
      </button>
    </div>

    <div id="videosTab" class="tab-content active">
      <h2 class="section-title">Catálogo de Cursos</h2>
      <div id="videoGrid" class="video-grid">
        <div class="loading">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Carregando vídeos...</p>
        </div>
      </div>
    </div>

    <div id="trailsTab" class="tab-content">
      <h2 class="section-title">Trilhas de Aprendizagem</h2>
      <div id="trailsList"></div>
    </div>

    <div id="rankingTab" class="tab-content">
      <h2 class="section-title">Ranking dos Alunos</h2>
      <div id="rankingList" class="ranking-list"></div>
    </div>

    <div id="progressTab" class="tab-content">
      <h2 class="section-title">Meu Progresso</h2>
      <div id="progressList"></div>
    </div>
  </div>

  <div id="videoModal" class="modal">
    <div class="modal-content">
      <button class="close-btn" onclick="closeVideoModal()">
        <i class="fas fa-times"></i>
      </button>
      
      <div id="vimeoPlayer"></div>
      
      <div class="video-details">
        <h2 id="modalVideoTitle"></h2>
        <div class="video-stats" id="videoStats"></div>
        <p id="modalVideoDescription"></p>
        
        <button class="like-btn" id="likeBtn" onclick="toggleLike()">
          <i class="fas fa-heart" id="likeIcon"></i>
          <span id="likeText">Curtir</span>
        </button>
      </div>
      
      <div id="quizSection" class="quiz-section">
        <h3>Quiz do Vídeo</h3>
        <div id="quizTimer" class="quiz-timer"></div>
        <div id="quizContainer"></div>
        <button class="btn-primary" onclick="submitQuiz()">Enviar Respostas</button>
      </div>
    </div>
  </div>

  <script>
    var currentUser = null;
    var allVideos = [];
    var allTrails = [];
    var currentVideoId = null;
    var vimeoPlayer = null;
    var quizTimer = null;
    var quizTimeLeft = 0;
    var currentQuizzes = [];
    var userAnswers = {};

    function showToast(message, type) {
      var toast = document.createElement('div');
      toast.className = 'toast ' + (type || 'success');
      
      var iconClass = type === 'success' ? 'check-circle' : 
                      type === 'error' ? 'exclamation-circle' : 
                      type === 'warning' ? 'exclamation-triangle' : 'info-circle';
      
      toast.innerHTML = '<i class="fas fa-' + iconClass + '"></i><span>' + message + '</span>';
      
      document.body.appendChild(toast);
      
      setTimeout(function() {
        toast.classList.add('hiding');
        setTimeout(function() {
          toast.remove();
        }, 300);
      }, 4000);
    }

    window.onload = function() {
      loadCurrentUser();
      setupTabs();
      loadVideos();
      loadTrails();
    };

    function loadCurrentUser() {
      google.script.run
        .withSuccessHandler(function(user) {
          currentUser = user;
          document.getElementById('userName').textContent = user.name;
          document.getElementById('userPoints').innerHTML = '<i class="fas fa-star"></i><span>' + user.points + ' pontos</span>';
        })
        .withFailureHandler(function(err) {
          console.error('Erro ao carregar usuário:', err);
        })
        .getCurrentUser();
    }

    function setupTabs() {
      var tabs = document.querySelectorAll('.tab');
      tabs.forEach(function(tab) {
        tab.addEventListener('click', function() {
          document.querySelectorAll('.tab').forEach(function(t) {
            t.classList.remove('active');
          });
          document.querySelectorAll('.tab-content').forEach(function(c) {
            c.classList.remove('active');
          });
          
          tab.classList.add('active');
          var tabName = tab.getAttribute('data-tab');
          document.getElementById(tabName + 'Tab').classList.add('active');
          
          if (tabName === 'ranking') loadRanking();
          if (tabName === 'progress') loadProgress();
        });
      });
    }

    function loadVideos() {
      google.script.run
        .withSuccessHandler(function(videos) {
          var safeVideos = Array.isArray(videos) ? videos : [];
          allVideos = safeVideos;
          displayVideos(safeVideos);
        })
        .withFailureHandler(function(err) {
          console.error('Erro ao carregar vídeos:', err);
          showToast('Erro ao carregar vídeos', 'error');
          allVideos = [];
          displayVideos([]);
        })
        .getVideos();
    }

    function displayVideos(videos) {
      var grid = document.getElementById('videoGrid');
      
      if (!grid) {
        console.error('Elemento videoGrid não encontrado');
        return;
      }
      
      if (!videos || videos.length === 0) {
        grid.innerHTML = '<div class="empty-state"><i class="fas fa-video"></i><p>Nenhum vídeo disponível</p></div>';
        return;
      }
      
      var html = '';
      videos.forEach(function(video) {
        var thumbnailHtml = video.thumbnail ? 
          '<img src="' + video.thumbnail + '" alt="' + video.title + '">' : 
          '<i class="fas fa-play-circle"></i>';
        
        html += '<div class="video-card" onclick="openVideo(\'' + video.id + '\')">' +
          '<div class="video-thumbnail">' + thumbnailHtml +
          '<div class="video-play-icon"><i class="fas fa-play"></i></div>' +
          '</div>' +
          '<div class="video-info">' +
          '<div class="video-title">' + video.title + '</div>' +
          '<div class="video-meta">' +
          '<span><i class="fas fa-eye"></i> ' + (video.views || 0) + '</span>' +
          '<span><i class="fas fa-heart"></i> ' + (video.likes || 0) + '</span>' +
          '</div></div></div>';
      });
      
      grid.innerHTML = html;
    }

    function openVideo(videoId) {
      currentVideoId = videoId;
      var video = null;
      for (var i = 0; i < allVideos.length; i++) {
        if (allVideos[i].id === videoId) {
          video = allVideos[i];
          break;
        }
      }
      
      if (!video) {
        showToast('Vídeo não encontrado', 'error');
        return;
      }
      
      if (!video.vimeoId) {
        showToast('ID do Vimeo não configurado', 'error');
        return;
      }
      
      document.getElementById('modalVideoTitle').textContent = video.title;
      document.getElementById('modalVideoDescription').textContent = video.description || '';
      document.getElementById('videoStats').innerHTML = 
        '<i class="fas fa-eye"></i> ' + (video.views || 0) + ' visualizações' +
        '<span style="margin: 0 12px;">•</span>' +
        '<i class="fas fa-heart"></i> ' + (video.likes || 0) + ' curtidas';
      
      var modal = document.getElementById('videoModal');
      modal.classList.add('active');
      
      var vimeoContainer = document.getElementById('vimeoPlayer');
      vimeoContainer.innerHTML = '';
      
      try {
        var iframe = document.createElement('iframe');
        iframe.src = 'https://player.vimeo.com/video/' + video.vimeoId;
        iframe.width = '100%';
        iframe.height = '500';
        iframe.frameborder = '0';
        iframe.allow = 'autoplay; fullscreen; picture-in-picture';
        vimeoContainer.appendChild(iframe);
        
        vimeoPlayer = new Vimeo.Player(iframe);
        
        vimeoPlayer.on('timeupdate', function(data) {
          var progress = (data.percent * 100).toFixed(2);
          if (progress >= 90) {
            google.script.run
              .withSuccessHandler(function() {
                loadQuiz(videoId);
              })
              .recordVideoView(videoId, progress, true);
          } else {
            google.script.run.recordVideoView(videoId, progress, false);
          }
        });
        
        google.script.run
          .withSuccessHandler(function(liked) {
            updateLikeButton(liked);
          })
          .withFailureHandler(function(err) {
            console.error('Erro ao verificar like:', err);
          })
          .isVideoLiked(videoId);
          
      } catch (error) {
        console.error('Erro ao carregar player:', error);
        showToast('Erro ao carregar vídeo', 'error');
      }
    }

    function closeVideoModal() {
      document.getElementById('videoModal').classList.remove('active');
      if (vimeoPlayer) {
        vimeoPlayer.destroy();
        vimeoPlayer = null;
      }
      if (quizTimer) clearInterval(quizTimer);
      document.getElementById('quizSection').style.display = 'none';
    }

    function toggleLike() {
      google.script.run
        .withSuccessHandler(function(result) {
          updateLikeButton(result.liked);
          loadCurrentUser();
          loadVideos();
        })
        .withFailureHandler(function(err) {
          console.error('Erro ao curtir:', err);
          showToast('Erro ao curtir vídeo', 'error');
        })
        .toggleLike(currentVideoId);
    }

    function updateLikeButton(liked) {
      var icon = document.getElementById('likeIcon');
      var text = document.getElementById('likeText');
      var btn = document.getElementById('likeBtn');
      
      if (liked) {
        icon.className = 'fas fa-heart';
        text.textContent = 'Curtido';
        btn.classList.add('liked');
      } else {
        icon.className = 'far fa-heart';
        text.textContent = 'Curtir';
        btn.classList.remove('liked');
      }
    }

    function loadQuiz(videoId) {
      google.script.run
        .withSuccessHandler(function(quizzes) {
          if (quizzes.length > 0) {
            currentQuizzes = quizzes;
            displayQuiz(quizzes);
          }
        })
        .withFailureHandler(function(err) {
          console.error('Erro ao carregar quiz:', err);
        })
        .getQuizzesByVideo(videoId);
    }

    function displayQuiz(quizzes) {
      var section = document.getElementById('quizSection');
      var container = document.getElementById('quizContainer');
      
      var html = '';
      quizzes.forEach(function(quiz, idx) {
        html += '<div class="quiz-question">' +
          '<h4>' + (idx + 1) + '. ' + quiz.question + '</h4>';
        
        quiz.options.forEach(function(option, optIdx) {
          html += '<label class="quiz-option">' +
            '<input type="radio" name="quiz_' + quiz.id + '" value="' + optIdx + '">' +
            option + '</label>';
        });
        
        html += '</div>';
      });
      
      container.innerHTML = html;
      section.style.display = 'block';
      
      quizTimeLeft = quizzes[0].time || 30;
      startQuizTimer();
    }

    function startQuizTimer() {
      var timerElement = document.getElementById('quizTimer');
      timerElement.textContent = quizTimeLeft + 's restantes';
      
      if (quizTimer) clearInterval(quizTimer);
      
      quizTimer = setInterval(function() {
        quizTimeLeft--;
        timerElement.textContent = quizTimeLeft + 's restantes';
        
        if (quizTimeLeft <= 0) {
          clearInterval(quizTimer);
          submitQuiz();
        }
      }, 1000);
    }

    function submitQuiz() {
      clearInterval(quizTimer);
      
      userAnswers = {};
      currentQuizzes.forEach(function(quiz) {
        var selected = document.querySelector('input[name="quiz_' + quiz.id + '"]:checked');
        if (selected) {
          userAnswers[quiz.id] = parseInt(selected.value);
        }
      });
      
      google.script.run
        .withSuccessHandler(function(result) {
          showToast('Quiz concluído! Pontuação: ' + result.score + '% • +' + result.points + ' pontos', 'success');
          document.getElementById('quizSection').style.display = 'none';
          loadCurrentUser();
        })
        .withFailureHandler(function(err) {
          console.error('Erro ao enviar quiz:', err);
          showToast('Erro ao enviar quiz', 'error');
        })
        .submitQuiz(currentQuizzes[0].id, currentVideoId, userAnswers);
    }

    function loadTrails() {
      google.script.run
        .withSuccessHandler(function(trails) {
          var safeTrails = Array.isArray(trails) ? trails : [];
          allTrails = safeTrails;
          displayTrails(safeTrails);
        })
        .withFailureHandler(function(err) {
          console.error('Erro ao carregar trilhas:', err);
          showToast('Erro ao carregar trilhas', 'error');
        })
        .getTrails();
    }

    function displayTrails(trails) {
      var container = document.getElementById('trailsList');
      
      if (!trails || trails.length === 0) {
        container.innerHTML = '<div class="empty-state"><i class="fas fa-route"></i><p>Nenhuma trilha disponível</p></div>';
        return;
      }
      
      var html = '';
      trails.forEach(function(trail) {
        html += '<div class="trail-card">' +
          '<div class="trail-header">' +
          '<div class="trail-title">' + trail.name + '</div>' +
          '<span>' + (trail.totalVideos || 0) + ' vídeos</span>' +
          '</div>' +
          '<p>' + (trail.description || '') + '</p>' +
          '<div class="trail-videos" id="trail_' + trail.id + '"></div>' +
          '</div>';
      });
      
      container.innerHTML = html;
      
      trails.forEach(function(trail) {
        if (trail.videos && trail.videos.length > 0) {
          var trailContainer = document.getElementById('trail_' + trail.id);
          var videosHtml = '';
          
          trail.videos.forEach(function(video) {
            var thumbHtml = video.thumbnail ? 
              '<img src="' + video.thumbnail + '" alt="' + video.title + '">' :
              '<i class="fas fa-play-circle"></i>';
            
            videosHtml += '<div class="video-card" onclick="openVideo(\'' + video.id + '\')">' +
              '<div class="video-thumbnail">' + thumbHtml +
              '<div class="video-play-icon"><i class="fas fa-play"></i></div>' +
              '</div>' +
              '<div class="video-info">' +
              '<div class="video-title">' + video.title + '</div>' +
              '</div></div>';
          });
          
          trailContainer.innerHTML = videosHtml;
        }
      });
    }

    function loadRanking() {
      google.script.run
        .withSuccessHandler(function(students) {
          displayRanking(students);
        })
        .withFailureHandler(function(err) {
          console.error('Erro ao carregar ranking:', err);
        })
        .getTopStudents();
    }

    function displayRanking(students) {
      var container = document.getElementById('rankingList');
      
      if (!students || students.length === 0) {
        container.innerHTML = '<div class="empty-state"><i class="fas fa-trophy"></i><p>Nenhum aluno no ranking ainda</p></div>';
        return;
      }
      
      var html = '';
      students.forEach(function(student, idx) {
        var posClass = idx === 0 ? 'top-1' : idx === 1 ? 'top-2' : idx === 2 ? 'top-3' : '';
        
        html += '<div class="ranking-item">' +
          '<div class="ranking-position ' + posClass + '">#' + (idx + 1) + '</div>' +
          '<div class="ranking-name">' + student.name + '</div>' +
          '<div class="ranking-points">' + student.points + ' pts</div>' +
          '</div>';
      });
      
      container.innerHTML = html;
    }

    function loadProgress() {
      google.script.run
        .withSuccessHandler(function(videos) {
          displayProgress(videos);
        })
        .withFailureHandler(function(err) {
          console.error('Erro ao carregar progresso:', err);
        })
        .getUserWatchedVideos();
    }

    function displayProgress(watchedVideos) {
      var container = document.getElementById('progressList');
      
      if (!watchedVideos || watchedVideos.length === 0) {
        container.innerHTML = '<div class="empty-state"><i class="fas fa-chart-line"></i><p>Você ainda não assistiu nenhum vídeo</p></div>';
        return;
      }
      
      var html = '<div class="video-grid">';
      watchedVideos.forEach(function(watched) {
        var video = null;
        for (var i = 0; i < allVideos.length; i++) {
          if (allVideos[i].id === watched.videoId) {
            video = allVideos[i];
            break;
          }
        }
        
        if (video) {
          var thumbHtml = video.thumbnail ?
            '<img src="' + video.thumbnail + '" alt="' + video.title + '">' :
            '<i class="fas fa-play-circle"></i>';
          
          var status = watched.completed ? 
            '<span style="color: var(--success);"><i class="fas fa-check-circle"></i> Completo</span>' :
            '<span style="color: var(--text-secondary);">' + watched.progress + '% assistido</span>';
          
          html += '<div class="video-card" onclick="openVideo(\'' + video.id + '\')">' +
            '<div class="video-thumbnail">' + thumbHtml +
            '<div class="video-play-icon"><i class="fas fa-play"></i></div>' +
            '</div>' +
            '<div class="video-info">' +
            '<div class="video-title">' + video.title + '</div>' +
            '<div class="video-meta">' + status + '</div>' +
            '</div></div>';
        }
      });
      html += '</div>';
      
      container.innerHTML = html;
    }
  </script>
</body>
</html>
